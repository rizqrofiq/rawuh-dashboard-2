(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6913,e=>{"use strict";var t=e.i(1398),s=e.i(1788),a=e.i(1158),r=e.i(9632),l=e.i(9338);function d(){let[e,d]=(0,s.useState)(null),[n,i]=(0,s.useState)([]),[c,x]=(0,s.useState)([]),[h,m]=(0,s.useState)([]),[u,o]=(0,s.useState)({present:0,absent:0,sick:0,permission:0,attendanceRate:0}),[p,b]=(0,s.useState)(!0),[v,j]=(0,s.useState)(null);if((0,s.useEffect)(()=>{!async function(){try{let[e,t]=await Promise.all([l.apiClient.getMyStats().catch(()=>({data:null})),l.apiClient.getMyClasses()]);d(e.data);let s=t.data||[];if(i(s),0===s.length)return void b(!1);let a=s.map(e=>l.apiClient.getSessionHistory(e.id).catch(()=>({data:[]}))),r=await Promise.all(a),n=[],c=new Map,h=0,u=0,p=0;r.forEach((e,t)=>{let a=s[t],r=e.data||[],l=0,d=0,i=0;r.forEach(e=>{if(e.total_students&&e.total_students>0){let t=e.present_count||0,s=e.total_students-t;l+=t,d+=s,i+=e.total_students;let a=c.get(e.week)||{present:0,absent:0,total:0};a.present+=t,a.absent+=s,a.total+=e.total_students,c.set(e.week,a),h+=t,u+=s,p+=e.total_students}}),i>0&&n.push({class:a,totalSessions:r.length,totalPresent:l,totalAbsent:d,totalStudents:r[0]?.total_students||0,attendanceRate:Math.round(l/i*100)})}),x(n);let v=Array.from(c.entries()).sort((e,t)=>e[0]-t[0]).slice(-8).map(([e,t])=>({week:e,present:t.present,absent:t.absent}));m(v);let j=p>0?Math.round(h/p*100):0;o({present:h,absent:u,sick:0,permission:0,attendanceRate:j})}catch(e){console.error("Failed to fetch statistics:",e),j(e instanceof Error?e.message:"Failed to load data")}finally{b(!1)}}()},[]),p)return(0,t.jsx)(r.default,{title:"Statistics",subtitle:"Loading...",children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 text-[var(--rawuh-text-muted)]",children:[(0,t.jsx)("span",{className:"material-symbols-outlined animate-spin",children:"progress_activity"}),(0,t.jsx)("span",{children:"Loading statistics..."})]})})});if(v)return(0,t.jsx)(r.default,{title:"Statistics",subtitle:"Error",children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-4xl text-[var(--rawuh-error)] mb-2",children:"error"}),(0,t.jsx)("p",{className:"text-[var(--rawuh-error)]",children:v}),(0,t.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-[var(--rawuh-primary)] text-white rounded-lg text-sm",children:"Retry"})]})})});let w=Math.max(...h.map(e=>e.present+e.absent),1);return(0,t.jsxs)(r.default,{title:"Statistics",subtitle:"Attendance statistics and analytics",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] p-5",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("div",{className:"w-10 h-10 rounded-lg bg-[var(--rawuh-primary-muted)] flex items-center justify-center",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-xl text-[var(--rawuh-primary)]",children:"school"})})}),(0,t.jsx)("p",{className:"text-3xl font-bold text-[var(--rawuh-text)]",children:e?.total_classes||n.length}),(0,t.jsx)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:"Total Classes"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] p-5",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("div",{className:"w-10 h-10 rounded-lg bg-[var(--rawuh-success-muted)] flex items-center justify-center",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-xl text-[var(--rawuh-success)]",children:"groups"})})}),(0,t.jsx)("p",{className:"text-3xl font-bold text-[var(--rawuh-text)]",children:e?.total_students??0}),(0,t.jsx)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:"Total Students"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] p-5",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("div",{className:"w-10 h-10 rounded-lg bg-[var(--rawuh-warning-muted)] flex items-center justify-center",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-xl text-[var(--rawuh-warning)]",children:"play_circle"})})}),(0,t.jsx)("p",{className:"text-3xl font-bold text-[var(--rawuh-text)]",children:e?.active_sessions??0}),(0,t.jsx)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:"Active Sessions"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] p-5",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("div",{className:"w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center",children:(0,t.jsx)("span",{className:"material-symbols-outlined text-xl text-green-600",children:"percent"})})}),(0,t.jsxs)("p",{className:"text-3xl font-bold text-[var(--rawuh-text)]",children:[u.attendanceRate,"%"]}),(0,t.jsx)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:"Avg. Attendance"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] p-5",children:[(0,t.jsx)("h3",{className:"font-semibold text-[var(--rawuh-text)] mb-4",children:"Weekly Attendance Trend"}),0===h.length?(0,t.jsx)("div",{className:"h-48 flex items-center justify-center text-[var(--rawuh-text-muted)]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-4xl mb-2",children:"bar_chart"}),(0,t.jsx)("p",{children:"No attendance data yet"})]})}):(0,t.jsxs)("div",{className:"relative h-[200px]",children:[(0,t.jsxs)("div",{className:"absolute left-0 top-0 h-[160px] flex flex-col justify-between text-xs text-[var(--rawuh-text-muted)] pr-2",children:[(0,t.jsx)("span",{children:w}),(0,t.jsx)("span",{children:Math.round(.5*w)}),(0,t.jsx)("span",{children:"0"})]}),(0,t.jsx)("div",{className:"absolute left-8 right-0 bottom-5 top-0 flex items-end justify-around gap-2",children:h.map(e=>{let s=e.present/w*160,a=e.absent/w*160;return(0,t.jsx)("div",{className:"flex flex-col items-center gap-1 flex-1",children:(0,t.jsxs)("div",{className:"flex flex-col items-center w-full max-w-[40px]",children:[(0,t.jsx)("div",{className:"w-full bg-[var(--rawuh-error)] rounded-t-sm",style:{height:`${a}px`}}),(0,t.jsx)("div",{className:"w-full bg-[var(--rawuh-success)]",style:{height:`${s}px`}})]})},e.week)})}),(0,t.jsx)("div",{className:"absolute left-8 right-0 bottom-0 flex justify-around",children:h.map(e=>(0,t.jsxs)("span",{className:"text-xs text-[var(--rawuh-text-muted)] flex-1 text-center",children:["W",e.week]},e.week))})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-[var(--rawuh-border)]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded bg-[var(--rawuh-success)]"}),(0,t.jsx)("span",{className:"text-xs text-[var(--rawuh-text-muted)]",children:"Present"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded bg-[var(--rawuh-error)]"}),(0,t.jsx)("span",{className:"text-xs text-[var(--rawuh-text-muted)]",children:"Absent"})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] p-5",children:[(0,t.jsx)("h3",{className:"font-semibold text-[var(--rawuh-text)] mb-4",children:"Overall Attendance Summary"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"text-center p-4 bg-[var(--rawuh-success-muted)] rounded-lg",children:[(0,t.jsx)("p",{className:"text-3xl font-bold text-[var(--rawuh-success)]",children:u.present}),(0,t.jsx)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:"Present"})]}),(0,t.jsxs)("div",{className:"text-center p-4 bg-[var(--rawuh-error-muted)] rounded-lg",children:[(0,t.jsx)("p",{className:"text-3xl font-bold text-[var(--rawuh-error)]",children:u.absent}),(0,t.jsx)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:"Absent/Other"})]})]}),(0,t.jsxs)("div",{className:"mt-4 pt-4 border-t border-[var(--rawuh-border)]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm text-[var(--rawuh-text-muted)]",children:"Attendance Rate"}),(0,t.jsxs)("span",{className:"text-sm font-semibold text-[var(--rawuh-text)]",children:[u.attendanceRate,"%"]})]}),(0,t.jsx)("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-[var(--rawuh-success)] rounded-full",style:{width:`${u.attendanceRate}%`}})})]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] overflow-hidden",children:[(0,t.jsx)("div",{className:"px-6 py-4 border-b border-[var(--rawuh-border)]",children:(0,t.jsx)("h3",{className:"font-semibold text-[var(--rawuh-text)]",children:"Class Statistics"})}),0===c.length?(0,t.jsxs)("div",{className:"p-8 text-center text-[var(--rawuh-text-muted)]",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-4xl mb-2",children:"school"}),(0,t.jsx)("p",{children:"No class data available"})]}):(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-[var(--rawuh-background)]",children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Class"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Sessions"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Present"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Absent"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Rate"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Actions"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-[var(--rawuh-border)]",children:c.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-[var(--rawuh-background)]",children:[(0,t.jsxs)("td",{className:"px-6 py-4",children:[(0,t.jsx)("p",{className:"font-medium text-[var(--rawuh-text)]",children:e.class.name}),(0,t.jsx)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:e.class.class_code})]}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 text-sm font-semibold",children:e.totalSessions})}),(0,t.jsx)("td",{className:"px-6 py-4 text-sm text-[var(--rawuh-success)] font-medium",children:e.totalPresent}),(0,t.jsx)("td",{className:"px-6 py-4 text-sm text-[var(--rawuh-error)] font-medium",children:e.totalAbsent}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-16 h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-[var(--rawuh-success)] rounded-full",style:{width:`${e.attendanceRate}%`}})}),(0,t.jsxs)("span",{className:"text-sm font-medium text-[var(--rawuh-text)]",children:[e.attendanceRate,"%"]})]})}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)(a.default,{href:`/classes/${e.class.id}`,className:"text-sm font-medium text-[var(--rawuh-primary)] hover:underline",children:"View Details"})})]},e.class.id))})]})]})]})}e.s(["default",()=>d])},2056,(e,t,s)=>{let a="/statistics";(window.__NEXT_P=window.__NEXT_P||[]).push([a,()=>e.r(6913)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([a])})},8761,e=>{e.v(t=>Promise.all(["static/chunks/df56c2ef92c6043e.js"].map(t=>e.l(t))).then(()=>t(3594)))},8805,e=>{e.v(t=>Promise.all(["static/chunks/5ec9ab7aae3f3e76.js"].map(t=>e.l(t))).then(()=>t(9466)))}]);