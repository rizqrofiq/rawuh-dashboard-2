(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2517,e=>{"use strict";var s=e.i(1398),t=e.i(1788),a=e.i(1158),r=e.i(9632),l=e.i(9338);function i(){let[e,i]=(0,t.useState)([]),[n,c]=(0,t.useState)([]),[d,o]=(0,t.useState)(!0),[x,u]=(0,t.useState)(null),[m,h]=(0,t.useState)("all");(0,t.useEffect)(()=>{!async function(){try{let[e,s]=await Promise.all([l.apiClient.getActiveSessions(),l.apiClient.getMyClasses()]);console.log("Active sessions:",e.data),console.log("Classes:",s.data);let t=e.data||[],a=s.data||[];c(a);let r=a.map(e=>l.apiClient.getSessionHistory(e.id).catch(()=>({data:[]}))),n=await Promise.all(r),d=[];n.forEach((e,s)=>{let t=a[s],r=(e.data||[]).map(e=>({...e,class_name:t.name,class_code:t.class_code,class_section:t.class_section,class_id:t.id}));d.push(...r)});let o=new Map;[...t,...d].forEach(e=>{o.has(e.session_id)||o.set(e.session_id,e)});let x=Array.from(o.values()).sort((e,s)=>{let t=e.created_at?new Date(e.created_at).getTime():0;return(s.created_at?new Date(s.created_at).getTime():0)-t});console.log("All sessions:",x),i(x)}catch(e){console.error("Failed to fetch sessions:",e),u(e instanceof Error?e.message:"Failed to load sessions")}finally{o(!1)}}()},[]);let p=e.filter(e=>"active"===m?!1!==e.is_active:"closed"!==m||!1===e.is_active),v=async e=>{try{await l.apiClient.closeSessionV2(e);let s=await l.apiClient.getActiveSessions();i(s.data||[])}catch(e){console.error("Failed to close session:",e),alert(e instanceof Error?e.message:"Failed to close session")}};return(0,s.jsxs)(r.default,{title:"Sessions",subtitle:"Manage attendance sessions",children:[(0,s.jsx)("div",{className:"flex items-center gap-4 mb-6",children:(0,s.jsx)("div",{className:"flex items-center bg-white rounded-lg border border-[var(--rawuh-border)] p-1",children:[{value:"all",label:"All Sessions"},{value:"active",label:"Active"},{value:"closed",label:"Closed"}].map(e=>(0,s.jsx)("button",{onClick:()=>h(e.value),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${m===e.value?"bg-[var(--rawuh-primary)] text-white":"text-[var(--rawuh-text-muted)] hover:text-[var(--rawuh-text)]"}`,children:e.label},e.value))})}),d&&(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsxs)("div",{className:"flex items-center gap-3 text-[var(--rawuh-text-muted)]",children:[(0,s.jsx)("span",{className:"material-symbols-outlined animate-spin",children:"progress_activity"}),(0,s.jsx)("span",{children:"Loading sessions..."})]})}),x&&(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("span",{className:"material-symbols-outlined text-4xl text-[var(--rawuh-error)] mb-2",children:"error"}),(0,s.jsx)("p",{className:"text-[var(--rawuh-error)]",children:x}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-[var(--rawuh-primary)] text-white rounded-lg text-sm",children:"Retry"})]})}),!d&&!x&&0===p.length&&(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("span",{className:"material-symbols-outlined text-4xl text-[var(--rawuh-text-muted)] mb-2",children:"event_busy"}),(0,s.jsx)("p",{className:"text-[var(--rawuh-text-muted)]",children:"No sessions found"})]})}),!d&&!x&&p.length>0&&(0,s.jsx)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-[var(--rawuh-background)]",children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase tracking-wider",children:"Class"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase tracking-wider",children:"Week"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase tracking-wider",children:"Attendance"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase tracking-wider",children:"Created"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-[var(--rawuh-border)]",children:p.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-[var(--rawuh-background)] transition-colors",children:[(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-[var(--rawuh-text)]",children:e.class_name||"Class Session"}),(0,s.jsxs)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:[e.class_code," - Section ",e.class_section]})]})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 text-sm font-semibold text-[var(--rawuh-text)]",children:e.week})}),(0,s.jsx)("td",{className:"px-6 py-4",children:!1!==e.is_active?(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-[var(--rawuh-success-muted)] text-[var(--rawuh-success)] text-xs font-medium",children:[(0,s.jsx)("span",{className:"w-1.5 h-1.5 bg-[var(--rawuh-success)] rounded-full animate-pulse"}),"Active"]}):(0,s.jsx)("span",{className:"inline-flex px-2.5 py-1 rounded-full bg-gray-100 text-gray-600 text-xs font-medium",children:"Closed"})}),(0,s.jsx)("td",{className:"px-6 py-4",children:e.total_students?(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-24 h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-[var(--rawuh-success)] rounded-full",style:{width:`${(e.present_count||0)/e.total_students*100}%`}})}),(0,s.jsxs)("span",{className:"text-sm text-[var(--rawuh-text)]",children:[e.present_count||0,"/",e.total_students]})]}):(0,s.jsx)("span",{className:"text-sm text-[var(--rawuh-text-muted)]",children:"-"})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-[var(--rawuh-text-muted)]",children:e.created_at?new Date(e.created_at).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a.default,{href:`/classes/${e.class_id}`,className:"p-2 flex items-center justify-center rounded-lg hover:bg-[var(--rawuh-primary-muted)] text-[var(--rawuh-primary)] transition-colors",children:(0,s.jsx)("span",{className:"material-symbols-outlined text-xl",children:"visibility"})}),!1!==e.is_active&&(0,s.jsx)("button",{onClick:()=>v(e.session_id),className:"p-2 rounded-lg hover:bg-[var(--rawuh-error-muted)] text-[var(--rawuh-error)] transition-colors",children:(0,s.jsx)("span",{className:"material-symbols-outlined text-xl",children:"stop_circle"})})]})})]},e.session_id))})]})})]})}e.s(["default",()=>i])},7521,(e,s,t)=>{let a="/sessions";(window.__NEXT_P=window.__NEXT_P||[]).push([a,()=>e.r(2517)]),s.hot&&s.hot.dispose(function(){window.__NEXT_P.push([a])})},8761,e=>{e.v(s=>Promise.all(["static/chunks/df56c2ef92c6043e.js"].map(s=>e.l(s))).then(()=>s(3594)))},8805,e=>{e.v(s=>Promise.all(["static/chunks/5ec9ab7aae3f3e76.js"].map(s=>e.l(s))).then(()=>s(9466)))}]);