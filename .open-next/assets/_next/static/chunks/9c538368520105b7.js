(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,9365,e=>{"use strict";var t=e.i(1398),s=e.i(1788),a=e.i(3828),r=e.i(1158),l=e.i(9632),i=e.i(4292),n=e.i(9338);function d({isOpen:e,onClose:a,classId:r,className:l,classCode:i,onSessionStarted:d}){let[c,o]=(0,s.useState)("select"),[x,m]=(0,s.useState)(1),[u,h]=(0,s.useState)("demo"),[p,b]=(0,s.useState)(!1),[v,f]=(0,s.useState)(null),[j,w]=(0,s.useState)(null),[g,N]=(0,s.useState)(null),[y,S]=(0,s.useState)(null);(0,s.useEffect)(()=>{e&&(o("select"),m(1),h("demo"),f(null),w(null),N(null),S(null))},[e]),(0,s.useEffect)(()=>{if("active"!==c||"original"!==u||!j)return;let e=setInterval(async()=>{try{let e=await n.apiClient.getSessionToken(j);N(e.data.token),S(e.data.expires_at)}catch(e){console.error("Failed to refresh token:",e)}},3e4);return()=>clearInterval(e)},[c,u,j]);let k=async()=>{b(!0),f(null);try{if("original"===u){let e=await n.apiClient.startSessionV1(r,x);w(e.data.session_id),N(e.data.token),S(e.data.expires_at)}else{let e=await n.apiClient.startSessionV2(r,x);w(e.data.session_id)}o("active"),d()}catch(e){f(e instanceof Error?e.message:"Failed to start session")}finally{b(!1)}},_=async()=>{if(j&&confirm("Are you sure you want to close this session?")){b(!0);try{"original"===u?await n.apiClient.closeSessionV1(j):await n.apiClient.closeSessionV2(j),d(),a()}catch(e){f(e instanceof Error?e.message:"Failed to close session")}finally{b(!1)}}};return e?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:a}),(0,t.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-6 py-4 border-b border-[var(--rawuh-border)] flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-[var(--rawuh-text)]",children:"select"===c?"Start New Session":"Active Session"}),(0,t.jsxs)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:[l," • ",i]})]}),(0,t.jsx)("button",{onClick:a,className:"p-2 rounded-lg hover:bg-gray-100 text-[var(--rawuh-text-muted)]",children:(0,t.jsx)("span",{className:"material-symbols-outlined",children:"close"})})]}),(0,t.jsxs)("div",{className:"p-6",children:[v&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-[var(--rawuh-error-muted)] border border-[var(--rawuh-error)]/20 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-[var(--rawuh-error)]",children:v})}),"select"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-[var(--rawuh-text)] mb-2",children:"Select Week"}),(0,t.jsx)("select",{value:x,onChange:e=>m(parseInt(e.target.value)),className:"w-full h-12 px-4 rounded-lg border border-[var(--rawuh-border)] bg-white text-[var(--rawuh-text)] font-medium focus:outline-none focus:ring-2 focus:ring-[var(--rawuh-primary)] focus:border-transparent cursor-pointer",children:Array.from({length:16},(e,t)=>t+1).map(e=>(0,t.jsxs)("option",{value:e,children:["Week ",e]},e))})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-[var(--rawuh-text)] mb-2",children:"Session Mode"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("button",{onClick:()=>h("original"),className:`p-4 rounded-xl border-2 text-left transition-all ${"original"===u?"border-[var(--rawuh-primary)] bg-[var(--rawuh-primary-muted)]":"border-[var(--rawuh-border)] hover:border-gray-300"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("span",{className:`material-symbols-outlined ${"original"===u?"text-[var(--rawuh-primary)]":"text-[var(--rawuh-text-muted)]"}`,children:"qr_code_2"}),(0,t.jsx)("span",{className:`font-semibold ${"original"===u?"text-[var(--rawuh-primary)]":"text-[var(--rawuh-text)]"}`,children:"Original"})]}),(0,t.jsx)("p",{className:"text-xs text-[var(--rawuh-text-muted)]",children:"QR code + Face recognition for attendance"})]}),(0,t.jsxs)("button",{onClick:()=>h("demo"),className:`p-4 rounded-xl border-2 text-left transition-all ${"demo"===u?"border-[var(--rawuh-primary)] bg-[var(--rawuh-primary-muted)]":"border-[var(--rawuh-border)] hover:border-gray-300"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("span",{className:`material-symbols-outlined ${"demo"===u?"text-[var(--rawuh-primary)]":"text-[var(--rawuh-text-muted)]"}`,children:"face"}),(0,t.jsx)("span",{className:`font-semibold ${"demo"===u?"text-[var(--rawuh-primary)]":"text-[var(--rawuh-text)]"}`,children:"Demo"})]}),(0,t.jsx)("p",{className:"text-xs text-[var(--rawuh-text-muted)]",children:"Face recognition only, no token required"})]})]})]}),(0,t.jsx)("button",{onClick:k,disabled:p,className:"w-full py-3 bg-[var(--rawuh-primary)] text-white rounded-xl font-semibold hover:bg-blue-600 disabled:opacity-50 flex items-center justify-center gap-2",children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"material-symbols-outlined animate-spin",children:"progress_activity"}),"Starting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"material-symbols-outlined",children:"play_circle"}),"Start Session"]})})]}),"active"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"text-center mb-6",children:[(0,t.jsxs)("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-[var(--rawuh-success-muted)] text-[var(--rawuh-success)] rounded-full mb-4",children:[(0,t.jsx)("span",{className:"w-2 h-2 bg-[var(--rawuh-success)] rounded-full animate-pulse"}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Session Active - Week ",x]})]}),(0,t.jsx)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:"original"===u?"Students can scan QR code and use face recognition":"Students can use face recognition to mark attendance"})]}),"original"===u&&g&&(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsxs)("div",{className:"bg-white border-2 border-[var(--rawuh-border)] rounded-xl p-6 flex flex-col items-center",children:[(0,t.jsxs)("div",{className:"w-48 h-48 bg-[var(--rawuh-background)] rounded-xl flex items-center justify-center mb-4 relative overflow-hidden",children:[(0,t.jsx)("div",{className:"absolute inset-4 border-2 border-dashed border-[var(--rawuh-text-muted)] rounded-lg"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-4xl text-[var(--rawuh-text-muted)]",children:"qr_code_2"}),(0,t.jsx)("p",{className:"text-xs text-[var(--rawuh-text-muted)] mt-2",children:"QR Code"})]})]}),(0,t.jsxs)("div",{className:"w-full p-3 bg-[var(--rawuh-background)] rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-[var(--rawuh-text-muted)] mb-1",children:"Session Token"}),(0,t.jsx)("p",{className:"font-mono text-lg font-bold text-[var(--rawuh-text)] tracking-wider text-center",children:g})]}),y&&(0,t.jsx)("p",{className:"text-xs text-[var(--rawuh-text-muted)] mt-2",children:"Token refreshes automatically"})]})}),"demo"===u&&(0,t.jsxs)("div",{className:"mb-6 p-6 bg-[var(--rawuh-background)] rounded-xl text-center",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-5xl text-[var(--rawuh-primary)] mb-3",children:"face"}),(0,t.jsx)("p",{className:"font-medium text-[var(--rawuh-text)]",children:"Face Recognition Mode"}),(0,t.jsx)("p",{className:"text-sm text-[var(--rawuh-text-muted)] mt-1",children:"Students can mark attendance using face recognition on the mobile app"})]}),(0,t.jsx)("button",{onClick:_,disabled:p,className:"w-full py-3 bg-[var(--rawuh-error)] text-white rounded-xl font-semibold hover:bg-red-600 disabled:opacity-50 flex items-center justify-center gap-2",children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"material-symbols-outlined animate-spin",children:"progress_activity"}),"Closing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"material-symbols-outlined",children:"stop_circle"}),"Close Session"]})})]})]})]})]}):null}function c(){let e=(0,a.useRouter)(),{id:c,startSession:o}=e.query,{user:x}=(0,i.useAuth)(),[m,u]=(0,s.useState)(null),[h,p]=(0,s.useState)([]),[b,v]=(0,s.useState)(null),[f,j]=(0,s.useState)([]),[w,g]=(0,s.useState)(null),[N,y]=(0,s.useState)([]),[S,k]=(0,s.useState)(!0),[_,C]=(0,s.useState)(null),[A,F]=(0,s.useState)("students"),[T,$]=(0,s.useState)(!1),[E,D]=(0,s.useState)(null),[P,I]=(0,s.useState)([]),[L,R]=(0,s.useState)(!1),V=x?.role==="lecturer";(0,s.useEffect)(()=>{"true"!==o||S||!m||w||($(!0),e.replace(`/classes/${c}`,void 0,{shallow:!0}))},[o,S,m,w,c,e]),(0,s.useEffect)(()=>{c&&V&&e();async function e(){try{k(!0);let e=parseInt(c),[t,s,a,r]=await Promise.all([n.apiClient.getClassDetails(e),n.apiClient.getClassStudents(e),n.apiClient.getClassStats(e),n.apiClient.getSessionHistory(e)]);u(t.data),p(s.data),v(a.data),j(r.data||[]);let l=(r.data||[]).find(e=>!1!==e.is_active);if(l){g(l);try{let e=await n.apiClient.getSessionStudents(l.session_id);y(e.data.students||[])}catch(e){console.error("Failed to fetch session students:",e)}}}catch(e){console.error("Failed to fetch class data:",e),C(e instanceof Error?e.message:"Failed to load class data")}finally{k(!1)}}},[c,V]);let W=async(e,t)=>{if(w)try{await n.apiClient.updateAttendanceStatus(w.session_id,e,t),y(s=>s.map(s=>s.id===e?{...s,status:t}:s))}catch(e){console.error("Failed to update status:",e),alert("Failed to update attendance status")}},B=async()=>{if(w&&confirm("Are you sure you want to close this session?"))try{await n.apiClient.closeSessionV2(w.session_id),g(null),y([]);let e=parseInt(c),t=await n.apiClient.getSessionHistory(e);j(t.data||[])}catch(e){console.error("Failed to close session:",e),alert("Failed to close session")}};return V?S?(0,t.jsx)(l.default,{title:"Loading...",subtitle:"",children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 text-[var(--rawuh-text-muted)]",children:[(0,t.jsx)("span",{className:"material-symbols-outlined animate-spin",children:"progress_activity"}),(0,t.jsx)("span",{children:"Loading class data..."})]})})}):_||!m?(0,t.jsx)(l.default,{title:"Error",subtitle:"",children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-4xl text-[var(--rawuh-error)] mb-2",children:"error"}),(0,t.jsx)("p",{className:"text-[var(--rawuh-error)]",children:_||"Class not found"}),(0,t.jsx)(r.default,{href:"/classes",className:"inline-flex mt-4 px-4 py-2 bg-[var(--rawuh-primary)] text-white rounded-lg text-sm",children:"Back to Classes"})]})})}):(0,t.jsxs)(l.default,{title:m.name,subtitle:m.class_code,children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)(r.default,{href:"/classes",className:"inline-flex items-center gap-1 text-sm text-[var(--rawuh-text-muted)] hover:text-[var(--rawuh-text)] mb-4",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-lg",children:"arrow_back"}),"Back to My Classes"]}),(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold text-[var(--rawuh-text)]",children:[m.name,(0,t.jsx)("span",{className:"ml-3 text-lg font-normal text-[var(--rawuh-text-muted)]",children:m.class_code})]}),(0,t.jsxs)("p",{className:"text-sm text-[var(--rawuh-text-muted)] mt-1",children:["Section ",m.class_section," • ",m.day,","," ",m.start_time," - ",m.end_time]})]}),(0,t.jsxs)("button",{onClick:()=>$(!0),disabled:!!w,className:"flex items-center gap-2 px-4 py-2.5 bg-[var(--rawuh-primary)] text-white rounded-lg text-sm font-semibold hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-lg",children:"add"}),w?"Session Active":"Start Session"]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 mb-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] p-5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3 text-[var(--rawuh-text-muted)]",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-xl",children:"groups"}),(0,t.jsx)("span",{className:"text-sm",children:"Total Students"})]}),(0,t.jsx)("p",{className:"text-3xl font-bold text-[var(--rawuh-text)]",children:b?.total_students??h.length})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] p-5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3 text-[var(--rawuh-text-muted)]",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-xl",children:"person"}),(0,t.jsx)("span",{className:"text-sm",children:"Lecturer"})]}),(0,t.jsx)("p",{className:"text-xl font-semibold text-[var(--rawuh-text)]",children:m.lecturer})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] p-5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3 text-[var(--rawuh-text-muted)]",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-xl",children:"event"}),(0,t.jsx)("span",{className:"text-sm",children:"Sessions"})]}),(0,t.jsx)("p",{className:"text-3xl font-bold text-[var(--rawuh-text)]",children:b?.total_sessions??f.length})]})]}),w&&(0,t.jsxs)("div",{className:"bg-gradient-to-r from-[var(--rawuh-primary)] to-blue-600 rounded-xl p-6 mb-6 text-white",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"w-3 h-3 bg-white rounded-full animate-pulse"}),(0,t.jsxs)("h3",{className:"text-lg font-semibold",children:["Active Session - Week ",w.week]})]}),(0,t.jsxs)("button",{onClick:B,className:"flex items-center gap-2 px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium transition-colors",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-lg",children:"stop_circle"}),"Close Session"]})]}),(0,t.jsxs)("div",{className:"bg-white/10 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("span",{className:"text-sm opacity-80",children:"Attendance Progress"}),(0,t.jsxs)("span",{className:"font-semibold",children:[N.filter(e=>"p"===e.status).length,"/",N.length]})]}),(0,t.jsx)("div",{className:"h-2 bg-white/20 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-white rounded-full transition-all",style:{width:`${N.length>0?N.filter(e=>"p"===e.status).length/N.length*100:0}%`}})})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)("button",{onClick:()=>F("students"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"students"===A?"bg-[var(--rawuh-primary)] text-white":"bg-white text-[var(--rawuh-text-muted)] border border-[var(--rawuh-border)]"}`,children:"Enrolled Students"}),(0,t.jsx)("button",{onClick:()=>F("sessions"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"sessions"===A?"bg-[var(--rawuh-primary)] text-white":"bg-white text-[var(--rawuh-text-muted)] border border-[var(--rawuh-border)]"}`,children:"Session History"})]}),"students"===A&&(0,t.jsx)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] overflow-hidden",children:0===h.length?(0,t.jsxs)("div",{className:"p-12 text-center",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-4xl text-[var(--rawuh-text-muted)] mb-2",children:"group_off"}),(0,t.jsx)("p",{className:"text-[var(--rawuh-text-muted)]",children:"No students enrolled"})]}):(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-[var(--rawuh-background)]",children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Name"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"NIM"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Email"}),w&&(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Status"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-[var(--rawuh-border)]",children:h.map(e=>{let s=N.find(t=>t.id===e.id);return(0,t.jsxs)("tr",{className:"hover:bg-[var(--rawuh-background)]",children:[(0,t.jsx)("td",{className:"px-6 py-4 font-medium text-[var(--rawuh-text)]",children:e.name}),(0,t.jsx)("td",{className:"px-6 py-4 text-sm text-[var(--rawuh-text)]",children:e.nim}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)("a",{href:`mailto:${e.email}`,className:"text-sm text-[var(--rawuh-primary)] hover:underline",children:e.email})}),w&&(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)("div",{className:"flex items-center gap-1",children:["p","i","s","a"].map(a=>{let r=n.attendanceStatusColors[a],l=s?.status===a;return(0,t.jsx)("button",{onClick:()=>W(e.id,a),className:`w-8 h-8 rounded-lg text-xs font-semibold transition-all ${l?`bg-[${r.bg}] text-[${r.text}] ring-2 ring-offset-1`:"bg-gray-100 text-gray-400 hover:bg-gray-200"}`,style:l?{backgroundColor:r.bg,color:r.text}:{},title:n.attendanceStatusLabels[a],children:a.toUpperCase()},a)})})})]},e.id)})})]})}),"sessions"===A&&(0,t.jsx)("div",{className:"bg-white rounded-xl border border-[var(--rawuh-border)] overflow-hidden",children:0===f.length?(0,t.jsxs)("div",{className:"p-12 text-center",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-4xl text-[var(--rawuh-text-muted)] mb-2",children:"event_busy"}),(0,t.jsx)("p",{className:"text-[var(--rawuh-text-muted)]",children:"No sessions yet"})]}):(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-[var(--rawuh-background)]",children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Week"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Status"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Date"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Attendance"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Actions"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-[var(--rawuh-border)]",children:f.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-[var(--rawuh-background)]",children:[(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-[var(--rawuh-primary-muted)] text-[var(--rawuh-primary)] font-semibold text-sm",children:e.week})}),(0,t.jsx)("td",{className:"px-6 py-4",children:!1!==e.is_active?(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-[var(--rawuh-success-muted)] text-[var(--rawuh-success)] text-xs font-medium",children:[(0,t.jsx)("span",{className:"w-1.5 h-1.5 bg-[var(--rawuh-success)] rounded-full animate-pulse"}),"Active"]}):(0,t.jsx)("span",{className:"inline-flex px-2.5 py-1 rounded-full bg-gray-100 text-gray-600 text-xs font-medium",children:"Closed"})}),(0,t.jsx)("td",{className:"px-6 py-4 text-sm text-[var(--rawuh-text-muted)]",children:e.created_at?new Date(e.created_at).toLocaleDateString():"-"}),(0,t.jsxs)("td",{className:"px-6 py-4 text-sm text-[var(--rawuh-text)]",children:[e.present_count??0,"/",e.total_students??0]}),(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsxs)("button",{onClick:async()=>{D(e),R(!0);try{let t=await n.apiClient.getSessionStudents(e.session_id);console.log("Session students response:",t);let s=t.data?.students||t.data||[];I(Array.isArray(s)?s:[])}catch(e){console.error("Failed to fetch attendees:",e),I([])}finally{R(!1)}},className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm text-[var(--rawuh-primary)] hover:bg-[var(--rawuh-primary-muted)] rounded-lg transition-colors",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-lg",children:"visibility"}),"View"]})})]},e.session_id))})]})}),E&&(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>D(null)}),(0,t.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-2xl mx-4 max-h-[80vh] overflow-hidden flex flex-col",children:[(0,t.jsxs)("div",{className:"px-6 py-4 border-b border-[var(--rawuh-border)] flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-[var(--rawuh-text)]",children:"Session Attendees"}),(0,t.jsxs)("p",{className:"text-sm text-[var(--rawuh-text-muted)]",children:["Week ",E.week," •"," ",E.created_at?new Date(E.created_at).toLocaleDateString():"-"]})]}),(0,t.jsx)("button",{onClick:()=>D(null),className:"p-2 rounded-lg hover:bg-gray-100 text-[var(--rawuh-text-muted)]",children:(0,t.jsx)("span",{className:"material-symbols-outlined",children:"close"})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-auto p-6",children:L?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)("span",{className:"material-symbols-outlined animate-spin text-[var(--rawuh-text-muted)]",children:"progress_activity"})}):0===P.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-4xl text-[var(--rawuh-text-muted)] mb-2",children:"group_off"}),(0,t.jsx)("p",{className:"text-[var(--rawuh-text-muted)]",children:"No attendance records"})]}):(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-[var(--rawuh-background)]",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Name"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"NIM"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Status"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Time"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-[var(--rawuh-text-muted)] uppercase",children:"Actions"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-[var(--rawuh-border)]",children:P.map(e=>{let s=e.status?n.attendanceStatusLabels[e.status]:"Not Recorded",a=e.status?n.attendanceStatusColors[e.status]:{bg:"#f3f4f6",text:"#6b7280"};return(0,t.jsxs)("tr",{className:"hover:bg-[var(--rawuh-background)]",children:[(0,t.jsx)("td",{className:"px-4 py-3 font-medium text-[var(--rawuh-text)]",children:e.name}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-[var(--rawuh-text-muted)]",children:e.nim}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("span",{className:"inline-flex px-2.5 py-1 rounded-full text-xs font-medium",style:{backgroundColor:a.bg,color:a.text},children:s})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-[var(--rawuh-text-muted)]",children:e.recorded_at?new Date(e.recorded_at).toLocaleTimeString():"-"}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("div",{className:"flex items-center gap-1",children:["p","i","s","a"].map(s=>{let a=e.status===s,r=n.attendanceStatusColors[s],l=e.student_id||e.id;return(0,t.jsx)("button",{onClick:async()=>{if(!l)return void alert("Student ID not available");try{await n.apiClient.updateAttendanceStatus(E.session_id,l,s),I(e=>e.map(e=>(e.student_id||e.id)===l?{...e,status:s}:e))}catch(e){console.error("Failed to update status:",e),alert("Failed to update attendance status")}},className:"w-7 h-7 rounded text-xs font-bold transition-all",style:{backgroundColor:a?r.bg:"transparent",color:a?r.text:"#9ca3af",border:a?"none":"1px solid #e5e7eb"},title:n.attendanceStatusLabels[s],children:s.toUpperCase()},s)})})})]},e.student_id||e.id||e.nim)})})]})}),(0,t.jsx)("div",{className:"px-6 py-4 border-t border-[var(--rawuh-border)] bg-[var(--rawuh-background)]",children:(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,t.jsxs)("span",{className:"text-[var(--rawuh-text-muted)]",children:["Total:"," ",(0,t.jsx)("strong",{className:"text-[var(--rawuh-text)]",children:P.length})]}),(0,t.jsxs)("span",{className:"text-[var(--rawuh-success)]",children:["Present:"," ",(0,t.jsx)("strong",{children:P.filter(e=>"p"===e.status).length})]}),(0,t.jsxs)("span",{className:"text-[var(--rawuh-warning)]",children:["Permission:"," ",(0,t.jsx)("strong",{children:P.filter(e=>"i"===e.status).length})]}),(0,t.jsxs)("span",{className:"text-blue-600",children:["Sick:"," ",(0,t.jsx)("strong",{children:P.filter(e=>"s"===e.status).length})]}),(0,t.jsxs)("span",{className:"text-[var(--rawuh-error)]",children:["Absent:"," ",(0,t.jsx)("strong",{children:P.filter(e=>"a"===e.status).length})]})]})})]})]}),(0,t.jsx)(d,{isOpen:T,onClose:()=>$(!1),classId:m.id,className:m.name,classCode:m.class_code,onSessionStarted:async()=>{let e=parseInt(c),t=await n.apiClient.getSessionHistory(e);j(t.data||[]);let s=(t.data||[]).find(e=>!1!==e.is_active);if(s){g(s);try{let e=await n.apiClient.getSessionStudents(s.session_id);y(e.data.students||[])}catch(e){console.error("Failed to fetch session students:",e)}}else g(null),y([])}})]}):(0,t.jsx)(l.default,{title:"Access Denied",subtitle:"",children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("span",{className:"material-symbols-outlined text-5xl text-[var(--rawuh-error)] mb-3",children:"lock"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-[var(--rawuh-text)] mb-2",children:"Access Denied"}),(0,t.jsx)("p",{className:"text-[var(--rawuh-text-muted)] mb-4",children:"Only lecturers can view class details."}),(0,t.jsx)(r.default,{href:"/",className:"inline-flex items-center gap-2 px-4 py-2 bg-[var(--rawuh-primary)] text-white rounded-lg text-sm font-medium",children:"Back to Dashboard"})]})})})}e.s(["default",()=>c],9365)},4737,(e,t,s)=>{let a="/classes/[id]";(window.__NEXT_P=window.__NEXT_P||[]).push([a,()=>e.r(9365)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([a])})},8761,e=>{e.v(t=>Promise.all(["static/chunks/df56c2ef92c6043e.js"].map(t=>e.l(t))).then(()=>t(3594)))},8805,e=>{e.v(t=>Promise.all(["static/chunks/5ec9ab7aae3f3e76.js"].map(t=>e.l(t))).then(()=>t(9466)))}]);